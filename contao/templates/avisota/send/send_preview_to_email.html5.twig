<form action="system/modules/avisota-message/web/send_preview_to_email.php" class="tl_form tl_form_avisota_inline"
      method="get">
    <input name="id" value="{{ message.id }}" type="hidden">
    <input name="REQUEST_TOKEN" value="{{ REQUEST_TOKEN }}" type="hidden">

    <fieldset id="pal_preview_to_email_legend" class="tl_box block">
        <legend onclick="AjaxRequest.toggleFieldset(this,'preview_to_email_legend','avisota_message_preview_to_email')">
            {{ _lang.avisota_message_preview.previewToEmail }}
        </legend>

        <div class="tl_formbody_edit">
            <div class="tl_tbox block">
                <div class="widget">
                    <h3>
                        <label for="ctrl_recipient_email"{% if emailMissing %} class="error"{% endif %}>{{ _lang.avisota_message_preview.sendPreviewToEmail[0] }}</label>
                    </h3>
                    <input name="recipient_email" id="ctrl_recipient_email" value="" class="tl_text"
                           onfocus="Backend.getScrollOffset();" type="text"/>

                    <p class="tl_help tl_tip{% if emailMissing %} tl_error{% endif %}">{{ _lang.avisota_message_preview.sendPreviewToEmail[1] }}</p>
                </div>
            </div>
        </div>

        <div class="tl_formbody_submit">
            <div class="tl_submit_container">
                <button id="btn-preview-to-email" name="preview-to-email" class="tl_submit" accesskey="p" type="submit" value="preview">
                    <img style="display: none;" src="assets/avisota/core/images/loading.gif"
                         alt=""/> {{ _lang.avisota_message_preview.sendPreview }}
                </button>
            </div>
        </div>
    </fieldset>
</form>

<script>
    $('btn-preview-to-email').addEvent('click', function () {
        var element = this;
        setTimeout(function () {
            element.getElement('img').setStyle('display', '');
            element.disabled = true;
        }, 1);
    });
</script>
